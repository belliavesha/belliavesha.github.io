<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collatz Tree Visualizer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="sidebar">
    <!-- Top Buttons -->
    <div class="top-buttons">
        <button id="renderBtn">Build Trees</button>
        <div class="dropdown">
            <button id="loadTreeBtn" class="dropdown-btn">Load Tree ▼</button>
            <div id="loadTreeDropdown" class="dropdown-content">
                <div class="dropdown-item" id="uploadOption">Upload File...</div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-item" data-file="data/tree-3.json">classic tree</div>
                <div class="dropdown-item" data-file="data/tree-265-rules-n÷2+3_3×n+1.json">with a twist</div>
                <div class="dropdown-item" data-file="data/tree-10-rules-n×3+1_(n+1)÷2+1.json">swap rules</div>
                <div class="dropdown-item" data-file="data/tree-11-rules-n×2+1_(n-1)÷3+1_n×4-1.json">triple chestnut</div>
                <div class="dropdown-item" data-file="data/tree-4.json">triple plane</div>
                <div class="dropdown-item" data-file="data/tree-25.json">quadruple oak</div>
                <div class="dropdown-item" data-file="data/tree-5-rules-(n÷2)-1_(3×n)+1_(n÷2)+1_(3×n)+1.json">quadruple maple</div>
                <div class="dropdown-item" data-file="data/tree-55_complex5bush.json">quintic bush </div>
                <input type="file" id="loadTreeFile" accept=".json" style="display: none;">
            </div>
        </div>
    </div>

    <hr style="border: 0; border-top: 1px solid #444; margin: 1px 0; width: 100%;">

    <!-- Main Two-Column Layout -->
    <div class="panel-grid">
        <!-- Left Column: Sample Parameters -->
        <div class="control-col">
            <div class="panel-section">
                <h4 style="margin-top: 2px;">Sample</h4>
                <div class="control-group">
                    <label for="sampleSize">Number of samples</label>
                    <input type="number" id="sampleSize" value="500">
                </div>
                <div class="control-group">
                    <label for="minValue">Lower limit</label>
                    <input type="number" id="minValue" value="1">
                </div>
                <div class="control-group">
                    <label for="rangeValue">Range</label>
                    <input type="number" id="rangeValue" value="1000">
                </div>
            </div>
        </div>

        <!-- Right Column: Root/Tree selector Parameters -->
        <div class="control-col">
            <div class="panel-section">
                <h4 style="margin-top: 2px;">Pick Tree</h4>
                <div class="control-group">
                    <label for="treeSelect">Select Root</label>
                    <select id="treeSelect" disabled><option>Build first...</option></select>
                </div>
                <div class="control-group">
                    <label for="startValue">Start Value</label>
                    <input type="number" id="startValue" placeholder="Value" value="1">
                </div>
                <div class="control-group">
                    <label for="treeModeToggle">Tree Selection Mode</label>
                    <div class="toggle-container">
                        <label class="toggle-switch">
                            <input type="checkbox" id="treeModeToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="toggle-label">By Start</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr style="border: 0; border-top: 1px solid #444; margin: 0px 0; width: 100%;">

    <!-- Rules and Angles Header/Initial Row -->
    <div class="panel-grid">
        <div class="control-group">
            <h4 style="margin-top: 2px;">Rules</h4>
            <label for="modulus">Modulus</label>
            <input type="number" id="modulus" value="2" min="2">
        </div>
        <!-- <div class="control-group knob-control"> -->
        <div class="control-group"> 
            <!-- <label>Rotation</label> -->
            <h4 style="margin-top: 2px;">Angles</h4>
            <div id="initAngleKnob" class="knob-container" data-target="initAngle" data-min="-180" data-max="180" data-value="0"></div>
            <input type="range" id="initAngle" min="-180" max="180" step="0.1" value="0" class="hidden-slider">
        </div>
    </div>

    <!-- Dynamic Rules and Angles Container -->
    <div id="dynamic-grid" class="panel-grid">
        <!-- Generated content: Rule Input | Angle Knob -->
    </div>
    <hr style="border: 0; border-top: 1px solid #444; margin: 0px 0; width: 100%;">
    
    <div class="legend-section" style="margin-top: 2px;">
        <div class="legend">
            <div class="legend-item"><span class="box" style="background:#9b59b6"></span> Root</div>
            <div class="legend-item"><span class="box" style="background:#4facfa"></span> Cycle start</div>
            <div class="legend-item"><span class="box" style="background:#2ecc71"></span> Longest</div>
            <div class="legend-item"><span class="box" style="background:#d15858"></span> Highest</div>
            <div class="legend-item"><span class="box" style="background:#f1c40f"></span> Smallest</div>
            <div class="legend-item"><span class="box" style="background:#ff8c00"></span> Highlighted</div>
            <a href="help.html" target="_blank" class="legend-btn help-link">Get Help</a>
        </div>
        <div class="legend-buttons"> 
            <button id="toggleLabelsBtn" class="legend-btn">Hide Labels</button>
            <button id="toggleBgBtn" class="legend-btn">Light Background</button>
            <button id="fitBtn" class="legend-btn">Fit to Screen</button>
            <button id="saveImgBtn" class="legend-btn">Save Image</button>
            <button id="saveTreeBtn" class="legend-btn">Save Tree Data</button>
        </div>
        
    </div>
    
    <!-- <div style="margin-top: auto; font-size: 0.7rem; color: #666;">
        Check console for debug output.
        Scroll to zoom. Drag to pan.
    </div> -->
</div>

<div id="canvas-container">
    <canvas id="mainCanvas"></canvas>
    <div id="labels-container"></div>
    <div id="tooltip"></div>
    <div id="loading">Processing...</div>
</div>

<script src="tree_math.js"></script>
<script src="tree_ui.js"></script>
</body>
</html>
